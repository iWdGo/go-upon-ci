language: go

arch: amd64

os:
  - windows
  - linux

go: 1.11.x

env:
  - GO111MODULE=auto

install:
  - export GITROOT=$(pwd)

before_script:
  - echo $GITROOT
  - export GOROOT_BOOTSTRAP=$(go env GOROOT)
  - mkdir golang
  - cd golang
  - git clone --branch master --single-branch --no-tags https://github.com/golang/go.git
  - cd go
  - export GOCLONE=$(pwd)
  - git log -1 --pretty=short
  - cd $GITROOT
  - mv make_travisci.bash ./golang/go/src/make.bash

script:
  - cd $GOROOT/src
  - sh ./make.bash

after_success:
  - rm -f ./cmd/dist/dist
  - cd $GOCLONE
  - export GOROOT= # get last commit from version file
  - ./bin/go tool dist version
  - ./bin/go tool dist test
