From 03793d5de19ede35a48b6be05840c110010ef4e6 Mon Sep 17 00:00:00 2001
From: Constantin Konstantinidis <constantinkonstantinidis@gmail.com>
Date: Sun, 12 Apr 2020 21:28:41 +0200
Subject: [PATCH] cmd/go: remove output of proxy_test log in tests

Fixes #29515
Fixes #30604

Change-Id: Ie75a331cd6ca51806c5720443506d4fe0bec28cf
---
 src/cmd/go/proxy_test.go | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/src/cmd/go/proxy_test.go b/src/cmd/go/proxy_test.go
index 8214488a59..841fd2dfd7 100644
--- a/src/cmd/go/proxy_test.go
+++ b/src/cmd/go/proxy_test.go
@@ -50,7 +50,9 @@ func StartProxy() {
 	proxyOnce.Do(func() {
 		readModList()
 		addr := *proxyAddr
+		quiet := ""
 		if addr == "" {
+			quiet = "/quiet"
 			addr = "localhost:0"
 		}
 		l, err := net.Listen("tcp", addr)
@@ -58,7 +60,7 @@ func StartProxy() {
 			log.Fatal(err)
 		}
 		*proxyAddr = l.Addr().String()
-		proxyURL = "http://" + *proxyAddr + "/mod"
+		proxyURL = "http://" + *proxyAddr + "/mod" + quiet
 		fmt.Fprintf(os.Stderr, "go test proxy running at GOPROXY=%s\n", proxyURL)
 		go func() {
 			log.Fatalf("go proxy: http.Serve: %v", http.Serve(l, http.HandlerFunc(proxyHandler)))
@@ -91,9 +93,6 @@ func readModList() {
 		encPath := strings.ReplaceAll(name[:i], "_", "/")
 		path, err := module.UnescapePath(encPath)
 		if err != nil {
-			if encPath != "example.com/invalidpath/v1" {
-				fmt.Fprintf(os.Stderr, "go proxy_test: %v\n", err)
-			}
 			continue
 		}
 		encVers := name[i+1:]
-- 
2.22.0.windows.1

